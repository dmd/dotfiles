export AB_HOME=/usr/local/abinitio
export AB_APPLICATION_HUB=/usr/local/abinitio-app-hub

export P4CONFIG=.p4config
export GIT_SSL_NO_VERIFY=true

export JAVA_HOME=/usr/java/latest
export PATH=/ab/tools/bin:/u/ddrucker/node-v4.5.0/bin:$JAVA_HOME/bin:$HOME/bisect:$PATH:$AB_HOME/bin
export LD_LIBRARY_PATH=$AB_HOME/lib:$LD_LIBRARY_PATH
export GOPATH=/u/ddrucker/go
export PATH=$GOPATH/bin:$PATH
export DISPLAY=ddrucker-7.abinitio.com:0.0

alias ic='ssh -Y ic-linux1'
alias ic7='ssh -Y ic-linux7'
alias ti='tmux new-window -n irc ssh -t dev.host TERM=screen-256color /usr/bin/weechat'
alias irc='ssh -t dev.host TERM=screen-256color /usr/bin/weechat'
alias icp='ssh -Y ic-prod1'
alias icpd='ssh -Y icdaemon@ic-prod1'
alias icd='sudo su - icdaemon'

alias vi=vimx

# switch to a particular coop (on ic-linux1, typically)
ch() {
    VERSION=$(echo $1 | awk --posix '/^2[0-9]{2}$/  { print "2-" substr($0, 2, 2)};
        /^2[0-9]{3}$/ { print "2-" substr($0, 2, 2) "-" substr($0, 4, 1)}
        /^3[0-9]$/ { print "3-" substr($0, 2, 1)}
        /^3[0-9]{2}$/ { print "3-" substr($0, 2, 1) "-" substr($0, 3, 1) }
        /^3[0-9]{3}$/ { print "3-" substr($0, 2, 1) "-" substr($0, 3, 1) "-" substr($0, 4, 1)}
        /^3[0-9]{4}$/ { print "3-" substr($0, 2, 1) "-" substr($0, 3, 1) "-" substr($0, 4, 2)}
        /\./ { gsub(/\./, "-") }
        /-/ { print }')

    if [ -z ${ORIGPATH+x} ]; then
        export ORIGPATH=$PATH
        export ORIGLD=$LD_LIBRARY_PATH
    fi
    export AB_HOME=/usr/local/abinitio-V$VERSION
    export PATH=$AB_HOME/bin:$ORIGPATH
    export LD_LIBRARY_PATH=$AB_HOME/lib:$ORIGLD
    m_env -v
}
setabhome() {
    export AB_HOME=$1
    export PATH="$AB_HOME/bin":$PATH
}

# journal

function log {
JOURNALDIR=/u/ddrucker/journals
JOURNALFILE="$JOURNALDIR/$(date +'%Y-%m-%d_%T').txt"
if [[ $# == 0 ]]; then
    vim +startinsert $JOURNALFILE
elif [[ $1 == "last" && $# == 1 ]]; then
    cat $(find $JOURNALDIR | sort | tail -1)
elif [[ $1 == "editlast" || $1 == "elast" ]]; then
    vim +startinsert $(find $JOURNALDIR | sort | tail -1)
elif [[ $1 == "dump" && $# == 1 ]]; then
    find $JOURNALDIR -type f -exec sh -c 'basename {} | sed "s,.txt,,;s,_, ,"' \; -exec cat {} \; -exec echo -e '\n---' \;
elif [[ $1 == "dml" && $# == 1 ]]; then
    echo "record
  datetime('YYYY-MM-DD HH24:MI:SS')('\n') dt;
  string('---\n') text;
end"
else
    echo $@ >> $JOURNALFILE
fi
}
